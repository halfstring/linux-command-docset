<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="Description">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <link rel="stylesheet" href="css/markdown-github.css">
  
</head>
<body>
<h1>
<a id="user-content-semanage" class="anchor" href="#semanage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>semanage</h1>
<p>默认目录的安全上下文查询与修改</p>
<h2>
<a id="user-content-补充说明" class="anchor" href="#%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>补充说明</h2>
<p><strong>semanage命令</strong> 是用来查询与修改SELinux默认目录的安全上下文。SELinux的策略与规则管理相关命令：seinfo命令、sesearch命令、getsebool命令、setsebool命令、semanage命令。</p>
<h3>
<a id="user-content-语法" class="anchor" href="#%E8%AF%AD%E6%B3%95" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>语法</h3>
<div class="highlight highlight-source-shell"><pre>semanage {login<span class="pl-k">|</span>user<span class="pl-k">|</span>port<span class="pl-k">|</span>interface<span class="pl-k">|</span>fcontext<span class="pl-k">|</span>translation} -l
semanage fcontext -{a<span class="pl-k">|</span>d<span class="pl-k">|</span>m} [-frst] file_spec</pre></div>
<h3>
<a id="user-content-选项" class="anchor" href="#%E9%80%89%E9%A1%B9" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>选项</h3>
<div class="highlight highlight-source-shell"><pre>-l：查询。
fcontext：主要用在安全上下文方面。
-a：增加，你可以增加一些目录的默认安全上下文类型设置。
-m：修改。
-d：删除。</pre></div>
<h3>
<a id="user-content-实例" class="anchor" href="#%E5%AE%9E%E4%BE%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>实例</h3>
<p>查询一下<code>/var/www/html</code>的默认安全性本文的设置：</p>
<div class="highlight highlight-source-shell"><pre>semanage fcontext -l
SELinux fcontext    <span class="pl-c1">type</span>          Context
....(前面省略)....
/var/www(/.<span class="pl-k">*</span>)<span class="pl-k">?</span>      all files     system_u:object_r:httpd_sys_content_t:s0
....(後面省略)....</pre></div>
<p>如上面例子所示，我们可以查询的到每个目录的安全性本文！而目录的设定可以使用正则表达式去指定一个范围。那么如果我们想要增加某些自定义目录的安全性本文呢？举例来说，我想要色设置<code>/srv/samba</code>成为 <code>public_content_t</code>的类型时，应该如何设置呢？</p>
<p>用semanage命令设置<code>/srv/samba</code>目录的默认安全性本文为<code>public_content_t</code>：</p>
<div class="highlight highlight-source-shell"><pre>mkdir /srv/samba
ll -Zd /srv/samba
drwxr-xr-x  root root root:object_r:var_t    /srv/samba</pre></div>
<p>如上所示，默认的情况应该是<code>var_t</code>这个咚咚的！</p>
<div class="highlight highlight-source-shell"><pre>semanage fcontext -l <span class="pl-k">|</span> grep <span class="pl-s"><span class="pl-pds">'</span>/srv<span class="pl-pds">'</span></span>
/srv/.<span class="pl-k">*</span>                     all files   system_u:object_r:var_t:s0
/srv/([^/]<span class="pl-k">*</span>/)<span class="pl-k">?</span>ftp(/.<span class="pl-k">*</span>)<span class="pl-k">?</span>     all files   system_u:object_r:public_content_t:s0
/srv/([^/]<span class="pl-k">*</span>/)<span class="pl-k">?</span>www(/.<span class="pl-k">*</span>)<span class="pl-k">?</span>     all files   system_u:object_r:httpd_sys_content_t:s0
/srv/([^/]<span class="pl-k">*</span>/)<span class="pl-k">?</span>rsync(/.<span class="pl-k">*</span>)<span class="pl-k">?</span>   all files   system_u:object_r:public_content_t:s0
/srv/gallery2(/.<span class="pl-k">*</span>)<span class="pl-k">?</span>         all files   system_u:object_r:httpd_sys_content_t:s0
/srv                        directory   system_u:object_r:var_t:s0   //看这里！</pre></div>
<p>上面则是默认的<code>/srv</code>底下的安全性本文资料，不过，并没有指定到<code>/srv/samba</code>。</p>
<div class="highlight highlight-source-shell"><pre>semanage fcontext -a -t public_content_t <span class="pl-s"><span class="pl-pds">"</span>/srv/samba(/.*)?<span class="pl-pds">"</span></span>
semanage fcontext -l <span class="pl-k">|</span> grep <span class="pl-s"><span class="pl-pds">'</span>/srv/samba<span class="pl-pds">'</span></span>
/srv/samba(/.<span class="pl-k">*</span>)<span class="pl-k">?</span>            all files   system_u:object_r:public_content_t:s0</pre></div>
<div class="highlight highlight-source-shell"><pre>cat /etc/selinux/targeted/contexts/files/file_contexts.local
<span class="pl-c"><span class="pl-c">#</span> This file is auto-generated by libsemanage</span>
<span class="pl-c"><span class="pl-c">#</span> Please use the semanage command to make changes</span>
/srv/samba(/.<span class="pl-k">*</span>)<span class="pl-k">?</span>    system_u:object_r:public_content_t:s0  <span class="pl-c"><span class="pl-c">#</span>写入这个档案</span></pre></div>
<div class="highlight highlight-source-shell"><pre>restorecon -Rv /srv/samba<span class="pl-k">*</span> <span class="pl-c"><span class="pl-c">#</span>尝试恢复默认值</span>
ll -Zd /srv/samba
drwxr-xr-x  root root system_u:object_r:public_content_t /srv/samba/  <span class="pl-c"><span class="pl-c">#</span>有默认值，以后用restorecon命令来修改比较简单！</span></pre></div>
<p>semanage命令的功能很多，这里主要用到的仅有fcontext这个选项的用法而已。如上所示，你可以使用semanage来查询所有的目录默认值，也能够使用它来增加默认值的设置！</p>


</body>
</html>